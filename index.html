<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <style>
    
    </style>
    
    <script src="src/arrayND.js"></script>
    <script src="src/GlobeNoise.class.js"></script>
    <script src="src/hash.js"></script>
    <script src="src/noise.js"></script>
    <script src="src/Simplex.class.js"></script>
    <script src="src/draw.js"></script>
    
    <script>
      var colorPicker = document.createElement("canvas");
      colorPicker.width = 256;
      colorPicker.height = 256;
      
      var gens = {
        height: new GlobeNoise(),
        heat: new GlobeNoise(),
        humidity: new GlobeNoise()
      };
      var settings = {
        width: 200,
        height: 100,
        height_octaves: 5,
        heat_octaves: 5,
        humidity_octaves: 5,
        height_bias: 0,
        heat_bias: 0,
        humidity_bias: 0,
        ice: 30,
        iceStrength: 0.5,
        iceAltitude: 0.5,
        iceAltitudeStrength: 0.5,
        
        ocean_height: 0,
        beach_height: 0.1,
        mountain_base: 0.6
      };
      
      var pals = {
        ocean: createNDArray([256, 256]),
        beach: createNDArray([256, 256]),
        plains: createNDArray([256, 256]),
        mountains: createNDArray([256, 256])
      };
    
      function onload()
      {
        let canvas = document.getElementById("canvas");
        canvas.height = settings.height;
        canvas.width = settings.width;
        
        // fill out the pals
        for(i of ["ocean", "beach", "plains", "mountains"])
        {
          let ctx = colorPicker.getContext('2d')
          ctx.drawImage(document.getElementById(i+"_map"), 0, 0, 256, 256);
          
          let c = ctx.getImageData(0, 0, 256, 256).data;
          
          let n = 0;
          for(let y = 0; y < 256; y++)
          {
            for(let x = 0; x < 256; x++)
            {
              let r = c[n++]; 
              let g = c[n++];
              let b = c[n++];
              n++; // alpha
              pals[i][x][y] = {r,g,b};
            }
          }
          
        }
        
        gens.height.generator.seed = refit(Math.random(), 0, 1, 0, 2**16, true, true);
        gens.heat.generator.seed = refit(Math.random(), 0, 1, 0, 2**16, true, true);
        gens.humidity.generator.seed = refit(Math.random(), 0, 1, 0, 2**16, true, true);
        
        draw(canvas, gens, settings);
      }
      
      function redraw()
      {
        let canvas = document.getElementById("canvas");
        canvas.height = settings.height;
        canvas.width = settings.width;
        document.getElementById("key").height = settings.height;
        draw(canvas, gens, settings)
      }
      
      // setting change handlers
      function changeSize(height)
      {
        settings.height=parseInt(height)
        settings.width = settings.height*2;
      }
      
      function changeSeed(which, text)
      {
        let generator = gens[which].generator;
        generator.seed = text.hashCode();
      }
      
      function updateSetting(which, value)
      {
        settings[which] = value;
      }
      
      function updateRadius(which, value)
      {
        gens[which].radius = value;
      }
    </script>
  </head>
  <body onload="onload()">
    <canvas id="canvas">
      
    </canvas>
    <img id="key" src="img/key.png" height=100/>
    
    
    <br/>
    <button onclick="redraw()">Redraw</button>
    <br/>
    
    <label>Image height</label> <input type="number" min=5 max=1024 value=100 onchange="changeSize(this.value)"/>
    <br/>
    <small>Image width is 2*image height. Work with a small image before increasing size for export.</small>
    <br/>
    <br/>
    
    <details>
      <summary>Height settings</summary>
      <label>Seed</label> <input type="text" onchange="changeSeed('height', this.value)"/>
      <br/>
      <label>Octaves</label> <input type="number" min=1 max=8 value=5 onchange="updateSetting('height_octaves', parseInt(this.value))"/>
      <br/>
      <label>Bias</label> <input type="number" min=-2 max=2 value=0 step=0.05 onchange="updateSetting('height_bias', parseFloat(this.value))"/>
      <br/>
      <label>Sampling radius</label> <input type="number" min=0.1 max=20 step=0.1 value=1 onchange="updateRadius('height', parseFloat(this.value))"/>
      <br/>
      <small>Note: higher sampling radius creates smaller biomes, while smaller radius creates larger biomes</small>
      
      <br/>
      <label>Sea level</label> <input type="range" min=-1 max=1 value=0 step=0.01 onchange="updateSetting('ocean_height', parseFloat(this.value))"/>
      <br/>
      <label>Beach length</label> <input type="range" min=0 max=0.25 value=0.01 step=0.001 onchange="updateSetting('beach_height', parseFloat(this.value))"/>
      <br/>
      <label>Mountain base</label> <input type="range" min=-1 max=1 value=0.6 step=0.01 onchange="updateSetting('mountain_base', parseFloat(this.value))"/>
      
    </details>
    <br/>
    
    <details>
      <summary>Heat settings</summary>
      <label>Seed</label> <input type="text" onchange="changeSeed('heat', this.value)"/>
      <br/>
      <label>Octaves</label> <input type="number" min=1 max=8 value=5 onchange="updateSetting('heat_octaves', parseInt(this.value))"/>
      <br/>
      <label>Bias</label> <input type="number" min=-2 max=2 value=0 step=0.05 onchange="updateSetting('heat_bias', parseFloat(this.value))"/>
      <br/>
      <label>Sampling radius</label> <input type="number" min=0.1 max=20 step=0.1 value=1 onchange="updateRadius('heat', parseFloat(this.value))"/>
      <br/>
      <small>Note: higher sampling radius creates smaller biomes, while smaller radius creates larger biomes</small>
      <br/>
      <label>Glacier %</label> <input type="number" min=0 max=100 value=30 onchange="updateSetting('ice', parseInt(this.value))"/>
      <br/>
      <label>Glacier strength</label> <input type="number" min=0 max=2 step=0.1 value=1 onchange="updateSetting('iceStrength', parseFloat(this.value))"/>
      <br/>
      <label>Mountain ice altitude</label> <input type="number" min=-2 max=2 step=0.1 value=0.5 onchange="updateSetting('iceAltitude', parseFloat(this.value))"/>
      <br/>
      <label>Mountain ice strength</label> <input type="number" min=0 max=2 step=0.1 value=1 onchange="updateSetting('iceAltitudeStrength', parseFloat(this.value))"/>
    </details>
    <br/>
    
    <details>
      <summary>Humidity settings</summary>
      <label>Seed</label> <input type="text" onchange="changeSeed('humidity', this.value)"/>
      <br/>
      <label>Octaves</label> <input type="number" min=1 max=8 value=5 onchange="updateSetting('humidity_octaves', parseInt(this.value))"/>
      <br/>
      <label>Bias</label> <input type="number" min=-2 max=2 value=0 step=0.05 onchange="updateSetting('humidity_bias', parseFloat(this.value))"/>
      <br/>
      <label>Sampling radius</label> <input type="number" min=0.1 max=20 step=0.1 value=1 onchange="updateRadius('humidity', parseFloat(this.value))"/>
      <br/>
      <small>Note: higher sampling radius creates smaller biomes, while smaller radius creates larger biomes</small>
    </details>
    <br/>
    
    <details>
      <summary>Biome maps</summary>
      <small>not currently settable, but maybe later...</small>
      <br/>
      <image id="ocean_map" src="img/ocean.png"/>
      <image id="beach_map" src="img/beach.png"/>
      <image id="plains_map" src="img/plains.png"/>
      <image id="mountains_map" src="img/mountains.png"/>
    </details>
    <hr/>
    <footer>
      <p>&copy; enoua5 2021</p>
      <p>Key is cropped and added to from <a href="https://commons.wikimedia.org/wiki/File:Vegetation.png">https://commons.wikimedia.org/wiki/File:Vegetation.png</a>, author: Ville Koistinen, <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a></p>
      <p>Open Simplex implementation: Stefan Gustavson, public domain</p>
    </footer>
  </body>
</html>
